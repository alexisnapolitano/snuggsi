const
  { test, browse, get }
    = require ('test')

, assets = require ('.')

, Server
    = require ('server')

, request
   = require ('request')

, fetch = require ('node-fetch')


// Warning coming out of koa-cors
// https://github.com/whatwg/misc-server/pull/76
// https://github.com/whatwg/misc-server/pull/70

test ('calling next middlewaree')

test ('Strict-Transport-Security', async t => {

  const
    server   = (new Server).serve ``
  , response = await fetch ('http://localhost:8181/')

  , age = 63072000
  , test = [`max-age=${age}`, 'includeSubDomains', 'preload']
  , expected = new RegExp ( test.join `; ` , 'g')


  t.ok
    (expected.test (response.headers.get ('strict-transport-security')))

  server.close ()
  t.end ()
})


test ('X-Content-Type-Options') // nosniff

test ('X-Frame-Options') // deny


test ('X-XSS-Protection') // 1; mode-block


test ('Access-Control-Allow-Origin: *', t => {

//const
//  server
//    = (new Server).serve ``

//fetch ('http://localhost:8181/', (_, response) => {
//  t.equal ('*', response.headers ['access-control-allow-origin'])
//})

//server.close ()
  t.end ()
})


//test ('Access-Control-Allow-Methods: *', t => {

//  const
//    server
//      = (new Server).serve ``

//  request.get ('http://localhost:8181/', (_, response) => {
//    t.equal ('GET', response.headers ['access-control-allow-methods'])
//  })

//  server.close ()
//  t.end ()
//})
