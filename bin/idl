#!/usr/bin/env node

// https://github.com/jsdom/webidl2js

const
  fs   = require ('fs')
, path = require ('path')
, out  = path.resolve (__dirname, '..', 'idl')
, Webidl2js = require ('webidl2js')

console.warn ('Converting IDL definitions', out)

const
  transformer = new Webidl2js ({ implSuffix: '-impl' /*, suppressErrors: true */ })

, addDir = (dir, resolved) =>
    (resolved = path.resolve (__dirname, dir))
      && transformer.addSource (resolved, resolved)


// May want to cleanup dir with rimraf
// https://github.com/tmpvar/jsdom/commit/8c1709bcfc9f58afa1357bfcc9035c937fca0913

addDir ('../custom-element-registry')

transformer
  .generate (out)
  .catch (error => !!! console.error (error) && process.exit (1))
