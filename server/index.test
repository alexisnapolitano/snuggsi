// http://taylor.fausak.me/2013/02/17/testing-a-node-js-http-server-with-mocha/

const
  { test, browse, get }
    = require ('test')

, { readFileSync: open }
    = require ('fs')

, { Server }
    = require ('..')

, fetch  = require ('node-fetch')

test ('new Server does not throw', t => {

  t.doesNotThrow ( _ => new Server )

  t.end ()
})


// should this default to current directory ?
test.only ('serve defaults to `public` when called without argument', async t => {

  const
    server   = ( new Server ).serve ()
  , response = await fetch (`http://localhost:${process.env.PORT}`)
  , expected = await response.body


    console.warn (expected)
//t.equal (response.body, open ('./public/index.html', 'utf-8'))

  server.close ``
  t.end ()
})


// should this default to current directory ?
test ('serve defaults to `public` when called with template literal', t => {

  var server = ( new Server ).serve ``

  get (`http://localhost:${process.env.PORT}/`, response => {
    console.log (response.statusCode)

    server.close ``
    t.end ()
  })
})
