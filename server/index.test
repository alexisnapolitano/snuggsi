// http://taylor.fausak.me/2013/02/17/testing-a-node-js-http-server-with-mocha/

const
  { test, browse, read }
    = require ('test')

, { Server }
    = require ('..')

, fetch = require ('node-fetch')


test ('new Server does not throw', t => {

  t.doesNotThrow ( _ => new Server )

  t.end ()
})


test ('serve defaults to `public` when called without argument', async t => {

  const
    server
      = ( new Server ).serve ()

  , resource
      = `http://localhost:${process.env.PORT}/favicon.ico`

  , { body }
      = await fetch (resource)


  t.equal
    ( await read (body), read `./public/favicon.ico` )

  server.close ``
  t.end ()
})


// should this default to current directory ?
test ('serve defaults to `public` when called with template literal', async t => {

  const
    server
      = ( new Server ).serve ``

  , resource
      = `http://localhost:${process.env.PORT}/favicon.ico`

  , { body }
      = await fetch (resource)


  t.equal
    ( await read (body), read `./public/favicon.ico` )

  server.close ``
  t.end ()
})
